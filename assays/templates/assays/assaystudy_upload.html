{% extends "base.html" %}
{% load static %}

{% block extra_head %}
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
{% endblock %}

{% block load_js %}
    <script src="{% static "assays/grouping_filtering.js" %}"></script>
    <script src="{% static "js/enter_override.js" %}"></script>
    <script src="{% static "assays/assaystudy_upload.js" %}"></script>
    <script src="{% static "assays/chart_display.js" %}"></script>
    <!--sck raw_plate-->
{#    <script type="text/javascript" charset="utf-8" src="{% static "js/tablecellsselection.js" %}"></script>#}

{% endblock %}

{% block breadcrumbs %}
    <li><a href="/assays/assaystudy/editable_studies/">Editable Studies</a></li>
    <li><a href="{{ object.get_absolute_url }}">{{ object }}</a></li>
    <li class="active">Upload Data File</li>
{% endblock %}

{% block sidebar %}
    {% include 'assays/grouping_filtering.html' with charts="true" %}
{% endblock %}

{% block fluid-content %}
    <form enctype="multipart/form-data" class="form-horizontal" method="post" >

    <!--all the functions on this page require the uploaded of a file (either previously or now), show always -->
    <h1>
        Upload Data File for <em>{{ object }}</em>
    <br>
    {% csrf_token %}
{#        <button id="submit" type="submit" class="btn btn-primary">Submit</button>#}
    </h1>

    <legend><br>Select the Type of File to Upload</legend>
    {# sck for raw_plate #}
    <label><input type="radio" name="upload_type" value="mif_c" checked="checked"> MIF-C </label>
    - Upload processed assay data in the required columnar format.
    <br>
    <label><input type="radio" name="upload_type" value="raw_plate"> Raw Plate </label>
    - Upload, process, and/or reprocess a plate reader output file and use the plate reader data processing tool.
    <br>
    <label><input type="radio" name="upload_type" value="supporting_data"> Supporting Data </label>
    - Attach a supporting data file to this study.
    <!--<label><input type="radio" name="upload_type" value="blue"> genomic</label> -->

    <div class="mif-c">
        {% include "submit.html" %}

        {% include 'errors.html' %}
    </div>

    {# sck for raw_plate Add/Edit Plate Maps#}
    <div class="raw-plate hidden">
        <legend><br>Plate Map General Information</legend>
        <div class="row">
            <div class="col-sm-12" >
                <b>Select <i>Starting</i> Source: </b>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12" >
                <label><input type="radio" name="plate_map_type_option" value="matrix"> Use an Existing Matrix </label>
                - MPS model is a plate and the same plate was put directly in the plate reader.
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12" >
                <label><input type="radio" name="plate_map_type_option" value="sample" checked="checked"> Previously Saved Plate Map </label>
                - Previously saved a plate map and want to edit or copy.
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12" >
                <label><input type="radio" name="plate_map_type_option" value="empty" > Empty Plate </label>
                - Start from an empty well plate.
            </div>
        </div>
    </div>


    {# sck for raw_plate Extra Info About Plate Maps#}
    <div class="raw-plate hidden">
        <div class="sample-times hidden">
            <div class="row">
                <div class="col-sm-12">
                    <i><b><br>Select Plate Map to Start: </b></i>
                    <select name="well_plate_select" form="well_plate_form">
                    <option value="0">-----------</option>
                    <option value="1">LDH 20190223 Plate Map for Day 1</option>
                    <option value="2">LDH 20190223 Plate Map for Day 2</option>
                    <option value="3">LDH 20190223 Plate Map for Day 3</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12" >
                    <label><input type="radio" name="plate_map_new_overwrite" value="new_map" checked="checked"> Copy to New      </label>
                    <label><input type="radio" name="plate_map_new_overwrite" value="overwrite_map" > Edit Map (save as) </label>
                </div>
            </div>
        </div>

        <div class="empty-times hidden">
            <div class="row">
                <div class="col-sm-12" >
                    <i><b>Select Plate Size: </b></i>
                    <select class="select-plate-size">
                    <option value="0">-----------</option>
                    <option value="24">24 - rows A-D columns 1-6</option>
                    <option value="96">96 - rows A-H columns 1-12</option>
                    <option value="384">384 - rows A-P columns 1-14</option>
                    </select>
                    <!--go over with Luke see line 598 of forms.py..make sure selected value shows in console log and in form!-->
                    {% include 'generic_field.html' with field=form.well_plate_size label=" " %}
                </div>
            </div>
            what was picked: <input type="text" name="testingme">
        </div>
        <div class="matrix-times hidden">
            <div class="row">
                <div class="col-sm-12">
                    <!--how to pull these from the study. go over with Luke-->
                    <i><b><br>Select Matrix to Start: </b></i>
                    <select>
                    <option value="0">-----------</option>
                    <option value="1">Matrix of Chips 1-6</option>
                    <option value="2">Matrix of Chips 12-16</option>
                    </select>
                </div>
                {% include 'generic_field.html' with field=form.matrix_list label="Matrix List" %}
            </div>
        </div>
        <div class="new-plate-map">
             <div class="row">
                <div class="col-sm-12" >
                    <i><b>Name New Plate Map: </b></i>
                    <form>
                      <input type="text" name="current_plate_map_name">
                    </form>
                </div>
            </div>
        </div>


        <div>
            <br>
            <br>

        </div>
    </div>

    {# sck for raw_plate Table of Chips that are set up#}
    <div class="raw-plate hidden">
        <legend><br>Chips in the Study</legend>
{% comment %}        <div class="container">
                <div class="row">
                    <div class="col-sm-12" >
                        <i><b><br>here: study name {{ object }}</b></i>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12" >
                        <p>id {{ object.id }}</p>
                    </div>
                </div>
        </div>{% endcomment %}

        <div class="row">
            <div class="col-sm-3" >
                <div>
                    <table class="table table-striped table-bordered">
                          <tr>
                            <td>filter</td>
                            <td>Chip ID</td>
                          </tr>
                          <tr>
                            <td>filter</td>
                            <td>thinking about</td>
                          </tr>
                    </table>
                </div>
            </div>
            <div class="col-sm-9" >
                <div>
                    <table class="table table-bordered table-inverse" summary="Table selection with plugin" id="tablecellsselection">
                    <!-- table is built in the js file-->
                    </table>
                </div>
            </div>
        </div>
        <br>
    </div>

    {# sck for raw_plate The Plate Map#}
    <div class="raw-plate hidden">
    <legend><br>Position Chips on the Plate</legend>

        <div class="row">
            <div class="col-sm-12" >
                <div>

                    <table class="table table-striped table-bordered">
                        <tr>
                           <td>thinking about</td>
                            <td>
                                <li>Category, Assay, Target</li>
                                <li>Well Use (may need to tie to assay; s b c)</li>
                                <li>Standards need an incrementor of sorts, samples need a selection (with time) of sorts.</li></td>
                        </tr>
                        <tr>
                            <td>lots of details to work out</td>
                            <td>blah blah</td>
                        </tr>
                        <tr>
                            <td>still</td>
                            <td>thinking about</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="raw-plate hidden">
        <div >
            <div class="row">
                <div class="col-sm-12" >
                    <i><b><br>Select unit and sample times to be used on this plate </b></i>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12" >
                    <label><input type="radio" name="sample_time_option" value="one_time_point" checked="checked"> One Sample Time </label>
                    - Samples on assay plate will be from 1 and only one time point.
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12" >
                    <label><input type="radio" name="sample_time_option" value="multiple_time_points"> Mixed Sample Times </label>
                    - Sample on assay plate will be from multiple time points.
                </div>
            </div>
        </div>
    </div>

    {# sck for raw_plate Table summarizing all previously plate map file processing (including way working on..if submitted)#}
    <div class="raw-plate hidden">
        <legend><br>Review Processing Status of Uploaded Plate Reader Data</legend>
        <li>make a table: Files uploaded, # data grids in file, Handling File Profile, Processing Opotions Saved?, Plate Mape(s), ....</li>
        <li> iflters Model, model version, sample location, assay time, chip</li>
        <li> check box of file to work with (recent import will need to be on table)</li>
        <br>
    </div>

    <!--all the functions on this page require the uploaded of a file (either previously or now), show always -->
    <legend><br>Select Data File to Upload</legend>
    <div class="raw-plate hidden">
        <p>To work with a file uploaded previously, check mark the file in the Status table and skip this step.</p>
        <br>
    </div>

    <!--could put this in a mif-c class div?-->
    {% if form.errors %}
        {% for error in form.bulk_file.errors %}
            <div class="alert alert-danger" role="alert">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                <span class="sr-only">Error:</span>
                {{ error }}
            </div>
        {% endfor %}
        {% for error in form.non_field_errors %}
            <div class="alert alert-danger" role="alert">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                <span class="sr-only">Error:</span>
                {{ error }}
            </div>
        {% endfor %}
    <div class="form-group has-error">
    {% else %}
    <div class="form-group">
    {% endif %}
        <label for="bulk_file" class="col-sm-2 control-label">File*</label>
        <div class="col-sm-10">
            {{ form.bulk_file }}
        </div>
    </div>

    {# sck for raw_plate Picking the processing options#}
    <div class="raw-plate hidden">
        <legend><br>Plate Reader Data Processing Options</legend>
        <li>if more than one grid, how handle?</li>
    </div>

    {# sck for raw_plate Calibrating data#}
    <div class="raw-plate hidden">
        <legend><br>Process Plate Reader Data (Calibrate)</legend>
    </div>

    {# sck for raw_plate Annotation (require dilition and cells to be entered in a table...#}
    <div class="raw-plate hidden">
        <legend><br>Annotate Plate Reader Data</legend>

        <br>
    </div>

    {# supporting_data section #}
    <div class="supporting-data hidden">
        {# NOT DRY #}
        {{ supporting_data_formset.management_form }}
        <legend><br>Supporting Data</legend>
        {% if supporting_data_formset.non_form_errors %}
            <div class="alert alert-danger" role="alert">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                <span class="sr-only">Error:</span>
                {{ supporting_data_formset.non_form_errors }}
            </div>
        {% endif %}

        {% if supporting_data_formset.errors %}
            {% for dict in supporting_data_formset.errors %}
                {% for key,value in dict.items %}
                    {% if key %}
                        <div class="alert alert-danger" role="alert">
                            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                            <span class="sr-only">Error:</span>
                            {{ forloop.parentloop.counter }}.) {{ key }} : {{ value }}
                        </div>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        {% endif %}

        <a id="add_button-{{ supporting_data_formset.prefix }}" class="btn btn-success" role="button">Add Supporting Data</a>
        <table class="table table-striped inlines" id="{{ supporting_data_formset.prefix }}-group" name="supporting_data">
            <thead>
                <tr>
                    <th>Description*</th>
                    <th>Supporting Data File*</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                {% for supporting_data in supporting_data_formset %}
                    <tr class="inline" id="supporting_data-{{ forloop.counter0 }}">
                        {% if supporting_data.id.value %}
                        <td class="original" hidden>
                            <input type="hidden"
                                   id="id_{{ supporting_data_formset.prefix }}-{{ forloop.counter0 }}-id"
                                   name="{{ supporting_data_formset.prefix }}-{{ forloop.counter0 }}-id"
                                   value="{{ supporting_data.id.value }}">
                        </td>
                        {% endif %}
                        <td>{{ supporting_data.description }}</td>
                        <td>{{ supporting_data.supporting_data }}</td>
                        <td>{{ supporting_data.DELETE }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {# raw_plate and mif-c#}
    <div class="raw-plate mif-c">
        {# Excluded for now #}
    {#    <div hidden>#}
    {#    {% include 'generic_field.html' with field=form.overwrite_option label="Overwrite Option*" %}#}
    {#    </div>#}

        <br>
        <div class="mif-c">
            <p>
                <a href="/media/excel_templates/chip_template-{{ version }}.xlsx">Click Here For Upload Template</a>
            </p>
        </div>
        <br>

        {% include 'assays/assaydatafileupload_table.html' with show_delete="true" group=object.group.name %}

        {# Temporary #}
        {# {% include 'assays/chart_options.html' with chart_title="New Data" chart_prefix="charts" %} #}
        {% include 'assays/sidebar_extras.html' with show_hide="true" %}

        <legend><br>Plots of Data Marked for Removal from the Study</legend>
        <!--This is something that has been discussed for all types of data-->
        <!--Bert had suggested that this be shown with the data that are added-->
        <!--the idea is to replace the auto marking of replaced values -->

        <legend><br>Plots of Data to Be Added to the Study</legend>
        <!--Plots of the data in the MIF-C file or that has been processed and is ready for submission to the main study-->

        <div id="charts" class="padded-bottom">Preview Unavailable</div>

        {# Revised for now #}
        {# {% include 'assays/chart_options.html' with chart_title="New Data" chart_prefix="new_charts" %} #}
        {# <div id="new_charts" class="padded-bottom">Preview Unavailable</div> #}

        {# {% include 'assays/chart_options.html' with chart_title="Current Data" chart_prefix="current_charts" %} #}
        {# <div id="current_charts" class="padded-bottom">No Current Data</div> #}

        {% include 'assays/group_table.html' %}
    </div>

    </form>
{% endblock %}
