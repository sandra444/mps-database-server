{% extends "base.html" %}
{% load static %}

{#{% block content %}#}
{#<p>loaded</p>#}
{#{% endblock %}#}

{# this template for add, update, and review all in one - need all conditionals to be accommidated #}

{% block load_js %}
    <script src="{% static "assays/assayplatereadermap_add.js" %}"></script>
{% endblock %}

{% block breadcrumbs %}
    <li><a href="/assays/assaystudy/">Studies</a>
    <li><a href="{{ form.instance.study.get_absolute_url }}">{{ form.instance.study }}</a></li>
    {% if object %}
        <li><a href="{% url 'assayplatereadermap-index' object.study.id %}">Assay Plate Reader Maps</a>
    {% else %}
        <li><a href="{% url 'assayplatereadermap-index' form.instance.study_id %}">Assay Plate Reader Maps</a>
    {% endif %}
    <li class="active">
        {% if object %}
            <em>{{ object }}</em>
        {% else %}
            Add
        {% endif %}
    </li>
{% endblock %}

{% block content %}
    <form class="form-horizontal" method="post" enctype="multipart/form-data">
        <div class="padded-bottom">
            {# title #}
            <div class="well">
                <h1 class="text-center">
                    <em><b>
                    {% if update %}
                        Update
                    {% else %}
                        {% if review %}
                            Review
                        {% else %}
                            Add
                        {% endif %}
                    {% endif %}
                    Assay Plate Map
                    </b></em><br><br>
                    {% if not add %}
                         {{ object.device }}
                        Well Plate Map: <em>{{ object }}</em>
                    {% else %}
                        to Study {{ form.instance.study }}
                    {% endif %}
                    <br>
                    {% csrf_token %}
                </h1>
            </div>

            {# pass to js file #}
            <div class="hidden">
                {# need this in javascript #}
                <div>
                    {{ assay_map_additional_info.ns_matrix_item }}
                    {{ assay_map_additional_info.ns_location }}
                    {{ form.form_number_file_block_combos }}
                </div>
                {# need this in javascript #}
                <div id="check_load">
                    {{ page_called }}
                </div>
                {# need this in javascript #}
                <div id="matrix_list_size">
                    {{ matrix_list_size }}
                </div>
                {# need this in javascript #}
                <div id="matrix_list_pk">
                    {{ matrix_list_pk }}
                </div>
                {# need this in javascript pass to ajax#}
                <div id="this_study_id">
                    {% if object %}
                        {{ object.study.id }}
                    {% else %}
                        {{form.instance.study_id}}
                    {% endif %}
                </div>
            </div>

            {# global plate map edits #}
            <div>
                {% if add %}
                    <div class="container show-when-add">

                        <div class="row">
                            <div class="col-md-3">
                                <div class="plate-map-page-field-labels-small">
                                    <div><p></p>
                                        <label><i>Start From</i></label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="plate-map-page-radio-contents">
                                    <label><input type="radio" name="start_map" value="a_plate" checked> Blank Assay Plate Map </label>
                                    <label><input type="radio" name="start_map" value="a_platemap"> Existing Assay Plate Map </label>
                                    <label><input type="radio" name="start_map" value="a_matrix"> Existing Study Matrix </label>
                                </div>
                            </div>
                            <div class="col-md-3"></div>
                        </div>
                    </div>
                {% endif %}

                {# need the size of the plate for all uses of this template #}
                <div>
                    <div class="container show-when-add">
                        <div>
                            <div class="pick-a-plate">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="plate-map-page-field-labels-small">
                                            <div><p id="plate_select_tooltip"></p>
                                                <label for="plate_select_tooltip">Starting Plate Format* &nbsp;</label>
                                            </div>
                                        </div>
                                    </div>
                                    {# this is id_device and it is used in drawing the plate map for all drawing options #}
                                    <div class="col-md-6">
                                        <div class="plate-map-page-field-contents required">
                                            {{ form.device }}
                                        </div>
                                    </div>
                                    <div class="col-md-3"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {% if add %}
                    <div class="container show-when-add">
                        <div>
                            <div class="pick-a-platemap hidden">
                                <div class="row">
                                    <div class="col-md-3">
                                         <div class="plate-map-page-field-labels-small">
                                            <div><p id="platemap_select_tooltip"></p>
                                                <label for="platemap_select_tooltip">Starting Plate Map* &nbsp;</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="plate-map-page-field-contents required">
                                            {{ assay_map_additional_info.se_platemap }}
                                        </div>
                                    </div>
                                    <div class="col-md-3"></div>
                                </div>
                            </div>
                            <div class="pick-a-matrix hidden">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="plate-map-page-field-labels-small">
                                            <div><p id="matrix_select_tooltip"></p>
                                                <label for="matrix_select_tooltip">Starting Study Matrix* &nbsp;</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="plate-map-page-field-contents required">
                                            {{ assay_map_additional_info.se_matrix }}
                                        </div>
                                    </div>
                                    <div class="col-md-3"></div>
                                </div>
                            </div>
                        </div>
                        {# options tried during development process - not what NOT to use #}
                        {# {% include 'generic_field.html' with field=form.device label="Device" %}#}
                        {# <br><b>form device</b> {% include 'generic_field.html' with field=form.device label="Plate Size"  %}#}
                        {# <br><b>plate size</b> <h4 id="object_plate_size">{{ object.device }}</h4>#}
                        {# <br><b>plate id</b> <h4 id="object_plate_id">{{ object.id }}</h4>#}
                        {# <br><b>study</b> <h4 id="object_study">{{ object.study }}</h4>#}
                        {# <br><b>study id </b> <h4 id="object_study">{{ object.study.id }}</h4>#}
                        {# <br><b>form name</b> {% include 'generic_field.html' with field=form.name label="Map Name"  %}#}
                        {##}
                        {# This takes FOREVER (HANDY) if queryset is not passed (dropdowns often need prefetches) #}
                        {# Study should be passed in backend - do not to the following!#}
                        {# {% include 'generic_field.html' with field=form.study label="Study" %}#}
                        {# <div class="hidden"><p>plate map id {{ object.id }}</p></div>#}
                        {# {{ object.study_assay_id }} #}
                        {# {{ object.study_assay }} #}
                        {# {{ form.instance.study_assay }} #}
                    </div>
                {% endif %}

                {% if not add %}
                    {# if not add and this plate map is in use by a file block #}
                    {% if form.form_number_file_block_combos.value > 0 %}
                        {# the form_number_file_block_combos is based on the AssayPlateReaderMapItemValue #}
                        {# not on the AssayPlateReaderMapDataFileBlock #}
                        {# if everything works correctly, they should match, but, values may be added AFTER file is added #}
                        {# so, there may be a number in the index, but no raw values showing in the plate map #}
                        <div class="container">
                            <div class="select-value-set">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="plate-map-page-field-labels-small">
                                            <div><p id="number_file_block_tooltip"></p>
                                                <label for="number_file_block_tooltip"># File/Blocks &nbsp;</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="plate-map-page-field-contents">
                                            {{ form.form_number_file_block_combos.value }}
                                        </div>
                                    </div>
                                    <div class="col-md-3"></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="plate-map-page-field-labels-small">
                                            <div><p id="file_block_tooltip"></p>
                                                <label for="file_block_tooltip">File/Blocks &nbsp;</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="plate-map-page-field-contents required">
                                            {{ form.se_block_select_string }}
                                            <div class="hidden">{{ form.ns_block_select_pk }}</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3"></div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                {% endif %}

                <div class="container">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels-small">
                                <div><p id="map_name_tooltip"></p>
                                    <label for="map_name_tooltip">Map Name* &nbsp;</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents required">
                                {{ form.name }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels-small">
                                <div><p></p>
                                    <label>Description (optional)</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents">
                                {{ form.description }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels-small">
                                <div><p id="sample_time_unit_tooltip"></p>
                                    <label for="sample_time_unit_tooltip">Time Unit* &nbsp;</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents required">
                                {{ form.time_unit }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels-small">
                                <div><p id="plate_cell_count_tooltip"></p>
                                    <label for="plate_cell_count_tooltip"># Cells &nbsp;</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents">
                                {{ form.cell_count }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels-small">
                                <div><p id="collection_volume_unit_tooltip"></p>
                                    <label for="collection_volume_unit_tooltip">Volume Unit &nbsp;</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents">
                                {{ form.volume_unit }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels-small">
                                <div><p id="standard_tooltip"></p>
                                    <label for="standard_tooltip">Assay Standard* &nbsp;</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents required">
                                {{ form.study_assay }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                </div>
            </div>
            <br>

            {# Selecting what to work on #}
            {% if not review %}
                <div class="container">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels-small">
                                <div>
                                    <div><p id="well_use_tooltip"></p>
                                        <label for="well_use_tooltip">Well Content to Add/Edit &nbsp;</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {# Lines for the drop down version#}
{#                        <div class="col-md-2">#}
{#                            <div class="plate-map-page-field-contents">#}
{#                                {{ assay_map_additional_info.se_well_use }}#}
{#                            </div>#}
{#                        </div>#}
{#                        <div class="col-md-7">#}
{#                        </div>#}

                        {# Lines for the radio button version#}
                        <div class="col-md-6">
                            <div class="plate-map-page-radio-contents">
                                <label><input type="radio" class="plate-map-bigger-radio" name="change_well_use" value="sample"><h3 class="plate-map-radio-spacing plate-map-no-wrap">Sample</h3></label>
                                <label><input type="radio" class="plate-map-bigger-radio" name="change_well_use" value="standard"><h3 class="plate-map-radio-spacing plate-map-no-wrap">Standard</h3></label>
                                <label><input type="radio" class="plate-map-bigger-radio" name="change_well_use" value="blank"><h3 class="plate-map-radio-spacing plate-map-no-wrap">Blank</h3></label>
                                <label><input type="radio" class="plate-map-bigger-radio" name="change_well_use" value="empty" checked><h3 class="plate-map-radio-spacing plate-map-no-wrap">Empty</h3></label>
                            </div>
                        </div>
                        <div class="col-md-3">
                        </div>

                    {# Both radio or dropdown#}
                    </div>
                </div>
            {% endif %}

            {# Working on the Samples #}
            <div>
                {% if not review %}
                    {# rows of select boxes used to edit  #}
                    <div class="container">
                        <div class="sample-section hidden">
                            <div class="row">
                                <div class="col-md-12">
                                    <h3><em>Check box next to value to place/change during drag or apply.</em></h3>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-3">
                                    <div><p id="sample_matrix_item_tooltip"></p>
                                        <label for="sample_matrix_item_tooltip">Study Matrix Item &nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div><p id="sample_location_tooltip"></p>
                                        <label for="sample_location_tooltip">Assay Sample Location &nbsp;</label>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                     <div><p id="sample_default_time_tooltip"></p>
                                         <label for="sample_default_time_tooltip">Assay Default Sample Time &nbsp;</label>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div><p id="sample_time_tooltip"></p>
                                        <label for="sample_time_tooltip">Sample Time (saved with file) &nbsp;</label>
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-md-2 plate-map-page-field-contents">
                                    {{ assay_map_additional_info.se_matrix_item }}
                                </div>
                                <div class="col-md-1">
                                    <div>
                                        {#  <label class="sample-section hidden"><input type="radio" name="sample_change" value="matrix_item"> Apply </label>#}
                                        <input id="checkbox_matrix_item" class="big-checkbox plate-map-check-box" type="checkbox" name="change_matrix_item" value="matrix_item" checked />
                                    </div>
                                </div>

                                <div class="col-md-2 plate-map-page-field-contents">
                                    {{ assay_map_additional_info.se_location }}
                                </div>
                                <div class="col-md-1">
                                    <div>
                                        {#  <label class="sample-section hidden"><input type="radio" name="sample_change" value="location"> Apply </label>#}
                                        <input id="checkbox_location" class="big-checkbox plate-map-check-box" type="checkbox" name="change_location" value="location" checked />
                                    </div>
                                </div>


{#                            add back and build functionality to change sample time after file block add if requested by users#}
                                <div class="col-md-2 plate-map-page-field-contents">
                                    {% if form.form_number_file_block_combos.value < 1 %}
                                        {{ assay_map_additional_info.form_number_default_time }}
                                    {% else %}
                                        <p>Edit not currently allowed.</p>
                                    {% endif %}
                                </div>
                                <div class="col-md-1">
                                    <div>
                                        {#  <label class="sample-section hidden"><input type="radio" name="sample_change" value="default_time"> Apply </label> #}
                                    {% if form.form_number_file_block_combos.value < 1 %}
                                        <input id="checkbox_default_time" class="big-checkbox plate-map-check-box" type="checkbox" name="change_default_time" value="default_time" checked />
                                    {% endif %}
                                    </div>
                                </div>

                                <div class="col-md-2 plate-map-page-field-contents">
                                    <p>Edit not currently allowed.</p>
{#                                    {{ assay_map_additional_info.form_number_time }}#}
                                </div>
                                <div class="col-md-1">
                                    <div>
                                        {#  <label class="sample-section hidden"><input type="radio" name="sample_change" value="time"> Apply </label>#}
                                        {% if form.form_number_file_block_combos.value > 0 %}
{#                                            <input id="checkbox_time" class="big-checkbox plate-map-check-box" type="checkbox" name="change_time" value="time" />#}
                                        {% endif %}
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="sample-section hidden">
                            <div class="row">
                                <div class="col-md-3">
                                    <div><p id="dilution_factor_tooltip"></p>
                                        <label for="dilution_factor_tooltip">Sample Dilution Factor &nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div><p id="collection_volume_tooltip"></p>
                                        <label for="collection_volume_tooltip">Efflux Collected Volume &nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div><p id="collection_time_tooltip"></p>
                                        <label for="collection_time_tooltip">Efflux Collection Time &nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                </div>
                            </div>
                            <div class="row">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-md-2 plate-map-page-field-contents">
                                            {{ assay_map_additional_info.form_number_dilution_factor }}
                                        </div>
                                        <div class="col-md-1">
                                            <div>
                                                <input id="checkbox_dilution_factor" class="big-checkbox plate-map-check-box" type="checkbox" name="change_dilution_factor" value="matrix_dilution_factor"  />
                                            </div>
                                        </div>

                                        <div class="col-md-2 plate-map-page-field-contents">
                                            {{ assay_map_additional_info.form_number_collection_volume }}
                                        </div>
                                        <div class="col-md-1">
                                            <div>
                                                <input id="checkbox_collection_volume" class="big-checkbox plate-map-check-box" type="checkbox" name="change_collection_volume" value="matrix_collection_volume"  />
                                            </div>
                                        </div>

                                        <div class="col-md-2 plate-map-page-field-contents">
                                             {{ assay_map_additional_info.form_number_collection_time }}
                                        </div>
                                        <div class="col-md-1">
                                            <div>
                                                <input id="checkbox_collection_time" class="big-checkbox plate-map-check-box" type="checkbox" name="change_collection_time" value="matrix_collection_time"  />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>

            {# Working on the Standards #}
            <div>
                {# rows of select boxes used to edit #}
                {% if not review %}
                    <div class="container">
                        <div class="standard-section hidden">
                            <div class="row">
                                <div class="col-md-12">
                                    <h3><em>The standard concentration unit must match the selected Assay Standard Method/Target/Unit.</em></h3>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-3">
                                    <div><p id="standard_value_tooltip"></p>
                                        <label for="standard_value_tooltip">Standard Value &nbsp;</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-md-3 plate-map-page-field-contents">
                                            {{ assay_map_additional_info.form_number_standard_value }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>

            {# Options for dragging #}
            <div class="drag-option-section hidden">
                {% if not review %}
                    <br>
                    <div class="container">
                        <div class="row">
                        {# <legend>Options for Drag/Apply in Plate Map</legend>#}
                        <div class="col-md-4">
                            <div class=row">
                                <label>Plate Map Drag and Apply Action</label>
                            </div>
                            <div class=row">
                                <input type="radio" name="change_method" value="copy" checked> Copy
                            </div>
                            <div class=row">
                                <input type="radio" name="change_method" value="increment"> Increment (Time or Standard Value only)
                            </div>
                        </div>
                        <div class="increment-section hidden">
                            <div class="col-md-2">
                                <div class=row">
                                    <label>Increment Operation</label>
                                </div>
                                <div class=row">
                                    {{ assay_map_additional_info.se_increment_operation }}
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class=row">
                                    <label>Increment By</label>
                                </div>
                                <div class=row">
                                    {{ assay_map_additional_info.form_number_increment_value }}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class=row">
                                    <label>Increment Direction</label>
                                </div>
                                <div class=row">
                                    <label><input type="radio" name="increment_direction" value="left-left" checked> Left to Right, Left to Right</label>
                                </div>
                                <div class=row">
                                    <label><input type="radio" name="increment_direction" value="right-right"> Right to Left, Right to Left</label>
                                </div>
                                <div class=row">
                                    <label><input type="radio" name="increment_direction" value="top-top"> Top to Bottom, Top to Bottom</label>
                                </div>
                                <div class=row">
                                    <label><input type="radio" name="increment_direction" value="bottom-bottom"> Bottom to Top, Bottom to Top</label>
                                </div>
                                <div class=row">
                                    <label><input type="radio" name="increment_direction" value="left-down"> Left to Right and Down</label>
                                </div>
                                <div class=row">
                                    <label><input type="radio" name="increment_direction" value="right-up"> Right to Left and Up</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class=row">
                            </div>
                        </div>
                    </div>
                    </div>
                {% endif %}
            </div>

            {# {{  formset }} is the wells in the map   #}
            <div>
                {#  <legend>Plate Map</legend>#}
                {#  table of well plate              #}
                <div class="col-md-12">
                    <table class="table table-bordered table-inverse" id="plate_table">
                        {#  note that the table is made in javascript #}
                    </table>
                </div>
            </div>


            {# Customize things to show in the plate map #}
            {# The visibility is also controlled in js file  #}
            <div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-3">
                        </div>
                        <div class="col-md-6">
                            <button type="button" class="btn btn-primary" id="checkboxButton">Show/Hide Customized Plate Map Display Options</button>
                        </div>
                        <div class="col-md-6">
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <div id="platemap_checkbox_section" class="toggle-display-none">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-12">
                                <table class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            <td>
                                                <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                    <input class="visibility-checkbox" type="checkbox" name="show_matrix_item" id="show_matrix_item" value=".matrix_item_start">
                                                    <div class="btn-group">
                                                        <label for="show_matrix_item" class="btn plate-matrix-item extra-tall-glyphicon">
                                                            <span class="glyphicon glyphicon-ok"></span>
                                                            <span> </span>
                                                        </label>
                                                        <label for="show_matrix_item" class="btn btn-default active">
                                                            Matrix Item
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                    <input class="visibility-checkbox" type="checkbox" name="show_location" id="show_location" value=".location_start">
                                                    <div class="btn-group">
                                                        <label for="show_location" class="btn plate-location extra-tall-glyphicon">
                                                            <span class="glyphicon glyphicon-ok"></span>
                                                            <span> </span>
                                                        </label>
                                                        <label for="show_location" class="btn btn-default active">
                                                            Sample Location
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                    <input class="visibility-checkbox" type="checkbox" name="show_dilution_factor" id="show_dilution_factor" value=".dilution_factor_start">
                                                    <div class="btn-group">
                                                        <label for="show_dilution_factor" class="btn plate-dilution-factor extra-tall-glyphicon">
                                                            <span class="glyphicon glyphicon-ok"></span>
                                                            <span> </span>
                                                        </label>
                                                        <label for="show_dilution_factor" class="btn btn-default active">
                                                            Dilution Factor
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="select-value-set">
                                                    <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                        <input class="visibility-checkbox" type="checkbox" name="show_default_time" id="show_default_time" value=".default_time_start"/>
                                                        <div class="btn-group">
                                                            <label for="show_default_time" class="btn plate-default-time extra-tall-glyphicon">
                                                                <span class="glyphicon glyphicon-ok"></span>
                                                                <span> </span>
                                                            </label>
                                                            <label for="show_default_time" class="btn btn-default active">
                                                                Plate Map Default Sample Time
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div>
                                                    <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                        <input class="visibility-checkbox" type="checkbox" name="show_time" id="show_time" value=".time_start"/>
                                                        <div class="btn-group">
                                                            <label for="show_time" class="btn plate-time extra-tall-glyphicon">
                                                                <span class="glyphicon glyphicon-ok"></span>
                                                                <span> </span>
                                                            </label>
                                                            <label for="show_time" class="btn btn-default active">
                                                                File Sample Time (Review Only)
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                            </td>
                                            <td>
                                                <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                    <input class="visibility-checkbox" type="checkbox" name="show_well_use" id="show_well_use" value=".well_use_start">
                                                    <div class="btn-group">
                                                        <label for="show_well_use" class="btn plate-well-use">
                                                            <span class="glyphicon glyphicon-ok"></span>
                                                            <span> </span>
                                                        </label>
                                                        <label for="show_well_use" class="btn btn-default active">
                                                            Well Content
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                    <input class="visibility-checkbox" type="checkbox" name="show_standard_value" id="show_standard_value" value=".standard_value_start">
                                                    <div class="btn-group">
                                                        <label for="show_standard_value" class="btn plate-standard-value extra-tall-glyphicon">
                                                            <span class="glyphicon glyphicon-ok"></span>
                                                            <span> </span>
                                                        </label>
                                                        <label for="show_standard_value" class="btn btn-default active">
                                                            Standard Value
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                    <input class="visibility-checkbox" type="checkbox" name="show_collection_volume" id="show_collection_volume" value=".collection_volume_start">
                                                    <div class="btn-group">
                                                        <label for="show_collection_volume" class="btn plate-collection-volume extra-tall-glyphicon">
                                                            <span class="glyphicon glyphicon-ok"></span>
                                                            <span> </span>
                                                        </label>
                                                        <label for="show_collection_volume" class="btn btn-default active">
                                                            Sample Efflux Volume
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                    <input class="visibility-checkbox" type="checkbox" name="show_collection_time" id="show_collection_time" value=".collection_time_start">
                                                    <div class="btn-group">
                                                        <label for="show_collection_time" class="btn plate-collection-time extra-tall-glyphicon">
                                                            <span class="glyphicon glyphicon-ok"></span>
                                                            <span> </span>
                                                        </label>
                                                        <label for="show_collection_time" class="btn btn-default active">
                                                            Sample Efflux Time
                                                        </label>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                    <input class="visibility-checkbox" type="checkbox" name="show_label" id="show_label" value=".label_start">
                                                    <div class="btn-group">
                                                        <label for="show_label" class="btn plate-label">
                                                            <span class="glyphicon glyphicon-ok check-mark-color"></span>
                                                            <span> </span>
                                                        </label>
                                                        <label for="show_label" class="btn btn-default active">
                                                          Label
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                    <input class="visibility-checkbox" type="checkbox" name="show_compound" id="show_compound" value=".compound_start">
                                                    <div class="btn-group">
                                                        <label for="show_compound" class="btn plate-compound">
                                                            <span class="glyphicon glyphicon-ok check-mark-color"></span>
                                                            <span> </span>
                                                        </label>
                                                        <label for="show_compound" class="btn btn-default active">
                                                            Compound
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                    <input class="visibility-checkbox" type="checkbox" name="show_cell" id="show_cell" value=".cell_start">
                                                    <div class="btn-group">
                                                        <label for="show_cell" class="btn plate-cell">
                                                            <span class="glyphicon glyphicon-ok check-mark-color"></span>
                                                            <span> </span>
                                                        </label>
                                                        <label for="show_cell" class="btn btn-default active">
                                                            Cells
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                    <input class="visibility-checkbox" type="checkbox" name="show_setting" id="show_setting" value=".setting_start">
                                                    <div class="btn-group">
                                                        <label for="show_setting" class="btn plate-setting">
                                                            <span class="glyphicon glyphicon-ok check-mark-color"></span>
                                                            <span> </span>
                                                        </label>
                                                        <label for="show_setting" class="btn btn-default active">
                                                            Settings
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="select-value-set">
                                                    <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                        <input class="visibility-checkbox" type="checkbox" name="show_block_raw_value" id="show_block_raw_value" value=".block_value_start">
                                                        <div class="btn-group">
                                                            <label for="show_block_raw_value" class="btn plate-block-raw-value extra-tall-glyphicon">
                                                                <span class="glyphicon glyphicon-ok check-mark-color"></span>
                                                                <span> </span>
                                                            </label>
                                                            <label for="show_block_raw_value" class="btn btn-default active">
                                                                Raw Value (Review Only)
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                            </td>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                                {% comment if want to add any of the other fields to display in the plate map....%}
                                    <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                        <input class="visibility-checkbox" type="checkbox" name="show_compound" id="show_compound" value=".compound_start">
                                        <div class="btn-group">
                                            <label for="show_compound" class="btn plate-compound">
                                                <span class="glyphicon glyphicon-ok check-mark-color"></span>
                                                <span> </span>
                                            </label>
                                            <label for="show_compound" class="btn btn-default active">
                                                caution flag, exclude, notes
                                            </label>
                                        </div>
                                    </div>
                                {% endcomment %}
            </div>


            {# This is the information that explains how the plate map is split into pieces #}
            {% include 'assaystudy_assayplatemap_help.html' %}




            {# reference table of chip setup USED TO feed the setup (compounds, cells, settings) but not anymore #}
            {# went a completely different way with this, but keep it here in case users ask for the table back, which, would need to populate in the views if they do.. #}
{#            <div class="">#}
{#                <div class="row">#}
{#                    <legend>For Reference - Chips in the Study</legend>#}
{#                    {% if matrix_items_in_study|length > 0 %}#}
{#                        <div class="padded-bottom">#}
{#                            <table id="matrix_items_table" class="table table-striped table-bordered dataTable">#}
{#                              If the table paginates, rows not on the page are not accessible, so, do not use the class that pagenates#}
{#                            <table id="matrix_items_table" class="table table-striped table-bordered dataTable">#}
{#                                <thead>#}
{#                                    <tr role="row">#}
{#                                        <th>Name</th>#}
{#                                        <th>Compound</th>#}
{#                                        <th>Compound Short</th>#}
{#                                        <th>Cell</th>#}
{#                                        <th>Cell Short</th>#}
{#                                        <th>Setting</th>#}
{#                                        <th>Setting Short</th>#}
{#                                    </tr>#}
{#                                </thead>#}
{#                                <tbody>#}
{#                                    {% for item in matrix_items_in_study %}#}
{#                                        <tr {{ item.id }}>#}
{#                                            <td>{{ item.name }}</td>#}
{#                                            <td id="cp{{ item.id }}-compound">{{ item.stringify_compounds|linebreaksbr }}</td>#}
{#                                            <td id="cp{{ item.id }}-compound-short">#}
{#                                                {%  if item.assaysetupcompound_set.all|length > 0 %}#}
{#                                                    {% for x in item.assaysetupcompound_set.all %}#}
{#                                                        {{ x.compound_instance.compound }} ({{ x.concentration }} {{ x.concentration_unit }})<br>#}
{#                                                    {% endfor %}#}
{#                                                {% else %}#}
{#                                                    -none-#}
{#                                                {% endif %}#}
{#                                            </td>#}
{#                                            <td id="cl{{ item.id }}-cell">{{ item.stringify_cells|linebreaksbr }}</td>#}
{#                                            <td id="cl{{ item.id }}-cell-short">#}
{#                                                {%  if item.assaysetupcell_set.all|length > 0 %}#}
{#                                                    {% for x in item.assaysetupcell_set.all %}#}
{#                                                        {{ x.cell_sample.cell_type }} ({{ x.density }} {{ x.density_unit }})<br>#}
{#                                                    {% endfor %}#}
{#                                                {% else %}#}
{#                                                    -none-#}
{#                                                {% endif %}#}
{#                                            </td>#}
{#                                            <td id="st{{ item.id }}-setting">{{ item.stringify_settings|linebreaksbr }}</td>#}
{#                                            <td id="st{{ item.id }}-setting-short">#}
{#                                                {%  if item.assaysetupsetting_set.all|length > 0 %}#}
{#                                                    {% for x in item.assaysetupsetting_set.all %}#}
{#                                                        {{ x.setting }} ({{ x.value }} {{ x.unit }})<br>#}
{#                                                    {% endfor %}#}
{#                                                {% else %}#}
{#                                                    -none-#}
{#                                                {% endif %}#}
{#                                            </td>#}
{#                                        </tr>#}
{#                                    {% endfor %}#}
{#                                </tbody>#}
{#                            </table>#}
{#                        </div>#}
{#                    {% else %}#}
{#                        <p>Not items have been setup in the study. Need to do that first.</p>#}
{#                    {% endif %}#}
{#                </div>#}
{#            </div>#}



            <div>
                <div>
                    {% if not review %}
                        {% include "submit.html" with flag="y" creator=object.created_by.id %}
                    {% endif %}
                </div>

                {% include 'errors.html' %}

                {% comment %}  <h6>tracking begin</h6>
                {% include 'tracking.html' %}
                <h6>tracking end</h6>{% endcomment %}
            </div>

            {# changes are made to the formsets and then saved   #}
    {# !!!!! when these are commented out, the form loads fast, not sure if issue with form or with js that happens when loads  #}
            {# need this (mangement_form) or form will not save   #}
            {{ formset.management_form }}
            <div class="hidden">
                <div class="no-selectize">
                    {# this is the main formset (plate and plate items)  #}
                    <h3>FormSet </h3>
                    <div id="formset">
                        {% for form in formset %}
{#                           do not uncomment or get dups --{{ form.id }}--#}
                            {# No ID tag for now #}
    {#                        <div id="{{ form.prefix }}" class="inline no-selectize">#}
                            <div class="inline no-selectize">
                            {{ form }}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {{ value_formset.management_form }}
            <div class="hidden">
                <div class="no-selectize">
                    <h3>value_formset </h3>
                    <div id="value_formset">
                        {% for vform in value_formset %}
{#                          do not uncomment or get dups  --{{ vform.id }}--#}
                            <div class="inline no-selectize">
                                {{ vform }}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            {# these are the ones that show to user  #}
            <div>
                {% if formset.errors %}
                    {% for field, error in formset.errors.items %}
                        <div class="alert alert-danger" role="alert">
                            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                            <span class="sr-only">Error:</span>
                            {{ error }}
                        </div>
                    {% endfor %}
                {% endif %}
                <br>
                {# this is not tested as of 20200107  #}
                {% if value_formset.errors %}
                    {% for field, error in value_formset.errors.items %}
                        <div class="alert alert-danger" role="alert">
                            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                            <span class="sr-only">Error:</span>
                            {{ error }}
                        </div>
                    {% endfor %}
                {% endif %}
            </div>

{#            {% if not review %}#}
{#                <div>#}
{#                    <h2>For Development Testing</h2>#}
{#                    Use for error checking#}
{#                    For testing<br>#}
{#                    form.errors<br>#}
{#                    {{ form.errors }}<br>#}
{#                    formset.errors<br>#}
{#                    {{ formset.errors }}<br>#}
{#                    value_formset.errors<br>#}
{#                    {{ value_formset.errors }}<br>#}
{#                </div>#}
{#            {% endif %}#}

        </div>

    </form>
{% endblock %}
